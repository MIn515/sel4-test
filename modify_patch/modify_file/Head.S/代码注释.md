```s
#include <config.h>
#include <util.h>

/* 指定代码段为 .boot.text，链接类型为 ax */
.section .boot.text, "ax"

/* _start 是全局标记，可以被链接器识别 */
.global _start

/* 声明外部符号，需要在其他地方定义 */
.extern init_kernel
.extern kernel_stack_alloc
.extern __global_pointer$
.extern restore_user_context
.extern trap_entry

/* _start 标记的代码段 */
_start:

/* 保存当前的 option，然后设置 norelax 选项 */
.option push
.option norelax

/* 设置全局指针 gp 为 __global_pointer$ 的地址 */
1:auipc gp, %pcrel_hi(__global_pointer$)
  addi  gp, gp, %pcrel_lo(1b)

/* 恢复之前的 option */
.option pop

/* 获取 hartid 存储在 a4 中 */
  /* hartid is in a4 */

/* 设置内核栈的大小为 CONFIG_KERNEL_STACK_BITS，然后乘以 hartid */
  li  sp, BIT(CONFIG_KERNEL_STACK_BITS)
  mul sp, sp, a4

/* 获取 kernel_stack_alloc 的地址，加上 CONFIG_KERNEL_STACK_BITS，然后把结果保存在 x1 中 */
  la  x1, (kernel_stack_alloc + (BIT(CONFIG_KERNEL_STACK_BITS)))

/* 把 x1 的值加到 sp 中，作为内核栈的起始地址 */
  add sp, sp, x1

/* 把 a4 的值保存到 sscratch 寄存器中，以便 init_kernel 使用 */
  csrrw x0, sscratch, a4 /* zero sscratch for the init task */

/* 跳转到 init_kernel 函数 */
  jal init_kernel

/* 设置返回地址为 restore_user_context，然后跳转 */
  la ra, restore_user_context
  jr ra

```
